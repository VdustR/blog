---
description: å› ç‚ºç•«åœ–çš„éœ€è¦ï¼Œåšäº†ä¸€å€‹ç°¡å–®çš„ç­‰æ¯”ä¾‹è¨ˆç®—æ©Ÿã€‚é€™ç¯‡é™¤äº†å±•ç¤ºæˆæœä¹‹å¤–ä¹Ÿæœƒå°±ä½¿ç”¨çš„ Jotai çš„å¿ƒå¾—åšä¸€äº›ç°¡å–®çš„è¨è«–ï¼Œä¹ŸåŒ…å«å’Œ zustand å’Œ React context çš„æ¯”è¼ƒã€‚
authors: [ViPro]
tags:
  - react
  - jotai
  - zustand
  - context
  - react
---

# Aspect Ratio Calculator with Jotai ğŸ‘»

å› ç‚ºç•«åœ–çš„éœ€è¦ï¼Œåšäº†ä¸€å€‹ç°¡å–®çš„ç­‰æ¯”ä¾‹è¨ˆç®—æ©Ÿã€‚

é€™ç¯‡é™¤äº†å±•ç¤ºæˆæœä¹‹å¤–ä¹Ÿæœƒå°±ä½¿ç”¨çš„ Jotai çš„å¿ƒå¾—åšä¸€äº›ç°¡å–®çš„è¨è«–ï¼Œä¹ŸåŒ…å«å’Œ zustand å’Œ React context çš„æ¯”è¼ƒã€‚

<!--truncate-->

## Aspect Ratio Calculator

<iframe
  src="https://codesandbox.io/embed/aspect-ratio-calculator-77cxz7?fontsize=14&hidenavigation=1&theme=dark"
  style={{
    width: "100%",
    height: 500,
    border: 0,
    borderRadius: 4,
    overflow: "hidden",
  }}
  title="Aspect Ratio Calculator"
  allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"
  sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
/>

[ğŸ‘‰ Open preview](https://77cxz7.csb.app/)

## Zustand

åœ¨é€™ä¹‹å‰æˆ‘å€‹äººæ¯”è¼ƒå¸¸ä½¿ç”¨çš„ state management æ˜¯ [zustand](https://github.com/pmndrs/zustand) ã€‚ç•¶åˆå…ˆå˜—è©¦ zustand çš„å‹•æ©Ÿï¼Œå…¶å¯¦æ˜¯ä¾†è‡ªä¸€å° [Buildable.dev](https://www.buildable.dev/) çš„ [Daniel Spataro](https://twitter.com/spataroinc) çš„ä¿¡ï¼Œè£¡é¢ä»‹ç´¹äº†ä»–å€‘å®¶çš„ç”¢å“ï¼Œå¦å¤–ä¹Ÿæ¨è–¦æˆ‘å˜—è©¦ä½¿ç”¨ zustand ã€‚ç ”ç©¶äº†ä¸€ä¸‹æ–‡ä»¶ä¹‹å¾Œè¦ºå¾— zustand çš„ API éå¸¸ç°¡å–®ï¼Œ bundle size ä¹Ÿéå¸¸å°ï¼Œä¸¦ä¸”å¯ä»¥è¼•æ˜“åœ°å’Œ React tree ä¹‹å¤–çš„æ±è¥¿äº’å‹•ï¼Œä¾‹å¦‚ï¼šæˆ‘å€‘ä¹‹å‰å°±æœ‰åœ¨ axios instance çš„ interceptors è£¡é¢æ›´æ–° request token ï¼Œè€Œé€™å€‹ token æ­£å¥½å°±èƒ½ä½¿ç”¨ [zustand/vallina](https://github.com/pmndrs/zustand#using-zustand-without-react) ä¾†ç®¡ç†ï¼Œä½¿ react å¤–çš„äº‹ä»¶æˆ–è³‡æ–™å¯ä»¥å’Œ react components äº’å‹•ã€‚ä¸»è¦æ˜¯åœ¨ refresh token å¤±æ•—çš„æ™‚å€™æœƒå°‡è©² store æ¸…ç©ºï¼Œè§¸ç™¼ react component é¡¯ç¤ºå·²ç™»å‡ºçš„æç¤ºã€‚

## Jotai

ä¸€é–‹å§‹æ˜¯æƒ³æ‰¾ zustand memo computed çš„æ–¹æ³•ï¼Œå¾Œä¾†æ‰¾åˆ°é€™ç¯‡: [Using getter to calculate computed values #132](https://github.com/pmndrs/zustand/issues/132) ï¼Œæ±ºå®šå˜—è©¦ä½¿ç”¨ Jotai ã€‚

## æ¯”è¼ƒ

å»ºè­°å¯ä»¥å…ˆçœ‹ [dai-shi](https://github.com/dai-shi) å¯«çš„æ¯”è¼ƒã€‚

- [How is jotai different from zustand? #13](https://github.com/pmndrs/jotai/issues/13)
- [How is Jotai different from Zustand?](https://jotai.org/docs/basics/comparison#how-is-jotai-different-from-zustand?)

å…©è€…çš„è¨­è¨ˆæ–¹å‘å®Œå…¨ä¸ä¸€æ¨£ï¼Œè§£æ±ºä¸ä¸€æ¨£çš„å•é¡Œã€‚æˆ‘å€‹äººæ˜¯èªç‚ºè¦–æƒ…æ³å…©å€‹éƒ½ä½¿ç”¨ä¹Ÿæ²’ä»€éº¼å•é¡Œã€‚æˆ‘ä¸»è¦æœƒæä¸€äº›åœ¨ä¸Šé¢æ–‡ç« ä»¥å¤–çš„æƒ³æ³•ã€‚

å…ˆå¾æˆ‘ä¸€é–‹å§‹çš„éœ€æ±‚é–‹å§‹èªªèµ·ã€‚

åœ¨ zustand ä¸­å¦‚æœè¦ memo computed value ï¼Œä¸€èˆ¬æœƒé€™æ¨£åšï¼š

```ts
/**
 * Memoizing selectors
 * https://github.com/pmndrs/zustand#memoizing-selectors
 */
const selector: Parameters<typeof useStore>[0] = ({ myValue }) => ({ myValue });

function MyComponent() {
  const { myValue } = useStore(selector);
  const computedValue = useMemo(() => heavyComputeFn(myValue), [myValue]);
  /* ... */
}
```

åƒé€™æ¨£çš„æƒ…æ³å¦‚æœ `MyComponent` è¢«æ‹¿ä¾†ä¸€æ¬¡æ¸²æŸ“å¤šå€‹ Node æˆ–æ˜¯æœ‰å…¶ä»– component ä½¿ç”¨åŒæ¨£çš„ `heavyComputeFn()` ï¼Œç›¸åŒçš„è¨ˆç®—å°±æœƒè¢«é‡è¤‡åŸ·è¡Œï¼›

Jotai çš„æ–¹å¼æ˜¯ï¼š

```ts
const derivedAtom = atom((get) => heavyComputeFn(get(myAtom)));

function MyComponent() {
  const computedValue = useAtomValue(derivedAtom);
  /* ... */
}
```

ç›¸åŒçš„æƒ…æ³ä¸‹ `heavyComputeFn()` å°±åªæœƒåŸ·è¡Œä¸€æ¬¡ã€‚

é™¤äº†è§£æ±ºä¸Šé¢çš„éœ€æ±‚å¤–ï¼Œ Jotai é‚„æœ‰ä»¥ä¸‹å„ªé»ï¼š

- Jotai ä¸éœ€è¦åš [zustand Memoizing selectors](https://github.com/pmndrs/zustand#memoizing-selectors) çš„å„ªåŒ–ã€‚
- Jotai atom å¯ä»¥è‡ªè¨‚ update function ï¼Œé€šå¸¸æœƒè¨­è¨ˆå¾—æœ‰é»åƒ reducer ï¼Œé€™å€‹éƒ¨åˆ†é›–ç„¶æˆ‘æ¯”è¼ƒå–œæ­¡ zustand çš„å¯«æ³•ï¼Œä½†ä¸€èˆ¬çš„ä½¿ç”¨æƒ…æ³ä¸‹ zustand åªèƒ½ä½¿ç”¨åŒä¸€å€‹ store å…§çš„è³‡æ–™ï¼Œè€Œ jotai å¯ä»¥è‡ªç”±åœ°ä¾è³´å…¶ä»– atomã€‚å€‹äººååˆ†å»ºè­°æŠŠé‚è¼¯å¯èƒ½æœƒè¢«å…±ç”¨çš„éƒ¨åˆ†éƒ½ä½¿ç”¨ atom ä¾†è™•ç†ï¼Œæ²’ç”¨åˆ°çš„æ™‚å€™éƒ½ä¸æœƒè¢«åŸ·è¡Œï¼ŒåŸ·è¡Œçš„æ™‚å€™æœ€å¤šä¹Ÿåªæœ‰ä¸€æ¬¡ï¼Œè€Œå› ç‚º atom éƒ½æ˜¯åŒä¸€å€‹ instance æ‰€ä»¥ atom props çš„å‚³éä¹Ÿä¸æœƒé€ æˆ re-render ã€‚

å…©è€…çš„ Provider éƒ½ç„¡æ³•å–ä»£ Context Provider ï¼Œä»–å€‘çš„ props éƒ½æ˜¯ initial value è€Œä¸èƒ½ always computed ã€‚ åœ¨ [Aspect Ratio Calculator](https://codesandbox.io/s/aspect-ratio-calculator-77cxz7) å…§æˆ‘å°‡ atom å…¨éƒ¨éƒ½ä¸Ÿé€² Context Provider ä¸­ï¼Œé›–ç„¶åœ¨é€™å€‹ç¯„ä¾‹ä¸­æ²’æœ‰æ˜é¡¯çš„æ•ˆæœï¼Œä½†å¦‚æœç›¸åŒ computed atom value å¦‚æœåœ¨å¤šå€‹ component è¢«é‡è¤‡ä½¿ç”¨ä¸€æ¨£åªæœƒè¨ˆç®—ä¸€æ¬¡ã€‚æˆ‘èªç‚ºé€™æ¨£ä½¿ç”¨æ˜¯æ²’ä»€éº¼å¤§å•é¡Œçš„ï¼Œä½†è¦è¨˜å¾—ä¾†è‡ª Provider Props çš„å€¼å¿…é ˆåœ¨æ›´æ–°çš„æ™‚å€™ä¹ŸåŒæ­¥åˆ°å°æ‡‰çš„ atom ï¼Œè€Œä¸”æ™‚é–“ä¸Šä¹Ÿæ™šä¸€å€‹ tick ã€‚å¦‚æœä¸æ˜¯é«˜åº¦é‡è¤‡ heavy compute functon çœŸçš„éœ€è¦æ¸›å°‘å‘¼å«æ¬¡æ•¸çš„æ¥µç«¯è¤‡é›œçš„æƒ…æ³å»ºè­°é‚„æ˜¯ä½¿ç”¨ä¸€èˆ¬çš„ Context Provider å³å¯ã€‚å¯ä»¥åƒè€ƒ [Can Jotai be used in order to replace the React Context API? #973](https://github.com/pmndrs/jotai/discussions/973) ã€‚

## å€‹äººç¸½çµ

- Global / page contextï¼š jotai å’Œ zustand éƒ½ä¸éŒ¯ï¼Œå€‹äººèªç‚º jotai æ›´å‹ä¸€ç±Œï¼Œä¸»è¦æ˜¯ derivedAtom çš„éƒ¨åˆ†å¯ä»¥é¿å…é‡è¤‡è¨ˆç®—ã€‚
- éœ€è¦å’Œ React tree ä¹‹å¤–çš„äº‹ä»¶æˆ–è³‡æ–™äº’å‹•çš„ç‹€æ…‹ï¼š ç›´æ¥ zustand ã€‚
- Local Context / Nested Context ï¼š ç›®å‰å€‹äººè¦ºå¾—é‚„æ˜¯ React Context + Provider æ¯”è¼ƒå®¹æ˜“ç¶­è­·ï¼Œ **çœŸçš„æœ‰å¿…è¦æ¸›å°‘é‡è¤‡ç›¸åŒè¨ˆç®—çš„è©±** å†è€ƒæ…®åœ¨ provider å…§å¡ atom ã€‚

æˆ‘èªç‚ºæ²’æœ‰å“ªå€‹æ¯”è¼ƒå¥½ï¼Œéƒ½å„è‡ªæœ‰é©åˆä»–å€‘çš„åœ°æ–¹ã€‚ç”¨ï¼éƒ½ç”¨çˆ†å§ï¼
